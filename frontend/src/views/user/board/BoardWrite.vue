<template>
  <div class="write_container">
    <div class="input_container">
      <input v-model.trim="model.title" type="text" placeholder="제목">
    </div>
    <div class="editor_container">
      <editor-component v-model:content="model.content">
      </editor-component>
    </div>
    <div class="button_container">
      <button class="button" @click="goBoard">목록</button>
      <button class="button" @click="write">등록</button>
    </div>
  </div>
</template>

<script>
import EditorComponent from "@/components/common/EditorComponent.vue";
import BoardService from "@/services/BoardService";

export default {
  name: 'boardWrite',
  components: {EditorComponent},
  data() {
    return {
      mode: 'NEW', // new, edit,
      boardId: this.$route.params.boardId,
      type: this.$route.params.type,
      semesterId: this.getNumber(this.$route.params.semesterId, 0),
      model: {
        type: this.$route.params.type,
        semesterId: this.getNumber(this.$route.params.semesterId, 0),
        title: '',
        content: ''
      }
    }
  },
  mounted() {
    if (this.boardId) this.mode = 'EDIT';
    if (this.mode === 'EDIT') {
      this.getBoard();
    }
  },
  methods: {
    getBoard() {
      BoardService.getOne(this.boardId).then(({data}) => {
        this.model = data;
      });
    },
    write() {
      if (this.mode === 'NEW') {
        this.saveBoard();
      } else {
        this.updateBoard();
      }
    },
    saveBoard() {
      BoardService.save(this.model).then(({data}) => {
        console.log(data);
        this.goBoard();
      });
    },
    updateBoard() {
      BoardService.update(this.boardId, this.model).then(({data}) => {
        console.log(data);
        this.goView();
      });
    },
    goBoard() {
      this.$router.push({path: '/board/' + this.type, query: {semesterId: this.semesterId}});
    },
    goView() {
      this.$router.push('/board/' + this.type + '/' + this.semesterId + '/' + this.boardId);
    },
  },
  watch: {
    $route() {
      console.log('Write->', this.$route.params)
      if (this.$route.params) {
        const type = this.$route.params.type;
        const semesterId = this.getNumber(this.$route.params.semesterId, 0);
        this.model.type = type;
        this.type = type;

        this.model.semesterId = semesterId;
        this.semesterId = semesterId;

        this.boardId = this.$route.params.boardId;
      }
    }
  }
}
</script>
